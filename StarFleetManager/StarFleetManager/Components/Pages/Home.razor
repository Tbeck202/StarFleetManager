@page "/"
@rendermode InteractiveServer
@inject IStarShipService StarShipService

<PageTitle>Home</PageTitle>

<h1>Starships</h1>

@if (_creatingStarship)
{
    <EditStarShip SaveShipCallback="@AddStarShip" />
}

@if(_starShips.Count > 0)
{
    <button class="btn btn-secondary" @onclick="CreateStarShip">Create a StarShip</button>
    <ul>
        @foreach(var ship in _starShips)
        {
            <li>@ship.Name - @ship.Model</li>
        }
    </ul>
}
else
{
    <p>Your fleet is empty Admiral! What would you like to do?</p>
    <button class="btn btn-primary" @onclick="FillFleet">Seed Database</button>
    <button class="btn btn-secondary" @onclick="CreateStarShip">Create a StarShip</button>
}

@code{
    private List<StarShipView> _starShips = new();
    private bool _creatingStarship = false;

    protected override async Task OnInitializedAsync()
    {
        @if(_starShips is null || _starShips.Count == 0)
        {
            _starShips = await StarShipService.GetAllAsync();
        }
    }

    private async Task FillFleet()
    {
        bool dbSeeded = await StarShipService.SeedDataBaseAsync();
        StateHasChanged();
    }

    private void CreateStarShip()
    {
        _creatingStarship = true;
    }

    public async Task AddStarShip(StarShipView ship)
    {
        bool shipSaved = await StarShipService.DbAddStarShipAsync(ship);
        _creatingStarship = !shipSaved;
        StateHasChanged();
    }
}